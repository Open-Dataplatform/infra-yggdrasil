oauth2-proxy:
  # Oauth client configuration specifics
  extraArgs:
    cookie-domain: .westeurope.cloudapp.azure.com
    cookie-name: oauth2_proxy
    email-domain: '*'
    oidc-email-claim: oid
    oidc-issuer-url: https://login.microsoftonline.com/f7619355-6c67-4100-9a78-1847f30742e2/v2.0
    pass-access-token: true
    pass-authorization-header: true
    pass-user-headers: true
    pass-host-header: true
    provider: oidc
    reverse-proxy: true
    set-authorization-header: true
    set-xauthrequest: true
    whitelist-domain: .westeurope.cloudapp.azure.com

  # Node labels for pod assignment
  # Ref: https://kubernetes.io/docs/user-guide/node-selection/
  nodeSelector: {}

janus:
  enabled: true
  host: {{ .Values.ingress.hosts.main.host | quote }}
  certmanagerIssuer:
    name: {{ .Values.ingress.certmanagerissuer | quote }}
    kind: ClusterIssuer

  ingressRoutes:
    - name: oauth2-proxy
      entryPoints:
        - websecure
      routes:
      - kind: Rule
        match: PathPrefix(`/oauth2/`)
        services:
          - name: oauth2-proxy
            port: 80
        middlewares:
          - name: auth-headers
      certificate:
        enabled: true

  middlewares:
    - name: auth-headers
      spec:
        headers:
          sslRedirect: true
          stsSeconds: 315360000
          browserXssFilter: true
          contentTypeNosniff: true
          forceSTSHeader: true
          stsIncludeSubdomains: true
          stsPreload: true
          frameDeny: true
    - name: oauth-auth
      spec:
        forwardAuth:
          address: https://{{ .Values.ingress.hosts.main.host }}/oauth2/auth
          trustForwardHeader: true
          #TODO remove
          tls:
            insecureSkipVerify: true
    - name: oauth-errors
      spec:
        errors:
          status:
            - "401-403"
          service:
            name: oauth2-proxy
            namespace: networking
            port: 80
          query: "/oauth2/sign_in"

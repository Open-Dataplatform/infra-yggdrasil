grafana:
  grafana.ini:
    server:
      #TODO HOST URL
      root_url: https://{{ .Values.ingress.hosts.main.host }}/grafana
    auth.proxy:
      enabled: true
      header_name: X-Forwarded-User
      header_property: email
      auto_sign_up: true
      sync_tll: 60
      headers: Groups:X-Forwarded-Role


  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://prometheus-server.monitoring
          access: proxy
          isDefault: true
          jsonData:
            timeInterval: '1m'
        - name: Loki
          type: loki
          url: http://loki.monitoring:3100
          access: proxy
          isDefault: false
          jsonData:
            timeInterval: '1m'
        # - name: Loki-prod
        #   type: loki
        #   url: https://dp-prod.westeurope.cloudapp.azure.com/loki
        #   access: proxy
        #   isDefault: false
        #   jsonData:
        #     timeInterval: '1m'

janus:
  enabled: true
  host: {{ .Values.ingress.hosts.main.host | quote }}
  certmanagerIssuer:
    name: {{ .Values.ingress.certmanagerissuer | quote }}
    kind: ClusterIssuer

  ingressRoutes:
    - name: grafana
      entryPoints:
        - websecure
      routes:
      - kind: Rule
        match: PathPrefix(`/grafana`)
        services:
          - name: grafana
            port: 80
        middlewares:
          - name: auth
            namespace: networking
          - name: grafana-stripprefix
      certificate:
        enabled: true

  middlewares:
    - name: grafana-stripprefix
      spec:
        stripPrefix:
          prefixes:
            - /grafana

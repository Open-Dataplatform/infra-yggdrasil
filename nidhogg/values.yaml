nidhogg:
  yggdrasil:
    repoURL: "https://github.com/Open-Dataplatform/infra-yggdrasil.git"
    targetRevision: "main"
    containerRegistryUrl: serviceacrpoc.azurecr.io
    ingress:
      LoadBalancerResoureGroup: service-aks-poc
      certmanagerissuer: letsencrypt-staging
      hosts:
        main:
          host: service-poc.westeurope.cloudapp.azure.com # This is what argocd will run on
          loadBalancerIP: 20.82.41.255
        vault:
          host: service-vault-poc.westeurope.cloudapp.azure.com
          loadBalancerIP: 20.82.41.148
        auth:
          host: service-auth-poc.westeurope.cloudapp.azure.com
          loadBalancerIP: 51.138.91.124

  installCNI: false

  argo-cd:
    controller:
      replicas: 3
      env:
        - name: "ARGOCD_CONTROLLER_REPLICAS"
          value: "3"
      enableStatefulSet: true
    redis-ha:
      enabled: true
    redis:
      enabled: false
    server:
      replicas: 3
      extraArgs:
        - --insecure
        - --rootpath
        - /argocd
      config:
        url: https://service-poc.westeurope.cloudapp.azure.com/argocd
        # repositories: |
        #   - type: helm
        #     url: https://argoproj.github.io/argo-helm

        # oidc.config: |
        #   name: Azure
        #   issuer: https://login.microsoftonline.com/{{ oauth_tenant_id }}/v2.0
        #   clientID: {{ oauth_client_id }}
        #   clientSecret: $oidc.azure.clientSecret
        #   requestedIDTokenClaims:
        #     groups:
        #       essential: true
        #   requestedScopes:
        #     - openid
        #     - profile
        #     - email

        resource.customizations: |
          admissionregistration.k8s.io/MutatingWebhookConfiguration:
            ignoreDifferences: |
              jsonPointers:
              - /webhooks/0/clientConfig/caBundle
          admissionregistration.k8s.io/ValidatingWebhookConfiguration:
            ignoreDifferences: |
              jsonPointers:
              - /webhooks/0/clientConfig/caBundle
              - /webhooks/0/namespaceSelector/matchExpressions/2
          apiextensions.k8s.io/CustomResourceDefinition:
            ignoreDifferences: |
              jsonPointers:
              - /spec/preserveUnknownFields
          networking.k8s.io/Ingress:
            health.lua: |
              hs = {}
              hs.status = "Healthy"
              return hs
          jaegertracing.io/Jaeger:
            health.lua: |
              hs = {}
              hs.status = "Healthy"
              return hs

    configs:
      secret:
        # This is not a secret password. It is okay to be on github
        argocdServerAdminPassword: $2y$12$m4KC7G9d8NFxInl7GRpQ1OpPPrF43Msa33ZQjj0YmT6f8uwjHW8AO
        argocdServerAdminPasswordMtime: "2021-01-02T15:04:05Z"
